<view class="page-container">
  <!-- 加载状态 -->
  <view xhs:if="{{isLoading}}" class="loading-container">
    <view class="loading-icon">⏳</view>
    <text class="loading-text">正在加载题目...</text>
  </view>

  <!-- 错误状态 -->
  <view xhs:elif="{{loadError}}" class="error-container">
    <view class="error-icon">⚠️</view>
    <text class="error-text">加载题目失败</text>
    <button class="btn-primary retry-btn" bindtap="loadQuestions">重试</button>
  </view>

  <!-- 正常内容 -->
  <view xhs:else>
    <!-- 进度条 -->
    <view class="progress-section">
      <view class="progress-header">
        <text class="progress-text">第 {{currentIndex + 1}} / {{questions.length}} 题</text>
        <text class="progress-percent">{{progressPercent}}%</text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{progressPercent}}%"></view>
      </view>
    </view>

      <!-- 题目卡片 -->
    <view class="question-card">
      <view class="question-number">Q{{currentIndex + 1}}</view>
      <text class="question-text">{{currentQuestion.question}}</text>
      
      <!-- 题目配图（可选） -->
      <image xhs:if="{{currentQuestion.image}}" 
             class="question-image" 
             src="{{currentQuestion.image}}" 
             mode="aspectFill"></image>
    </view>

    <!-- 选项按钮 -->
    <view class="options-section">
      <view class="option-card" bindtap="selectOption" data-value="yes">
        <view class="option-icon">✓</view>
        <view class="option-content">
          <text class="option-title">是的</text>
          <text class="option-desc">符合我的情况</text>
        </view>
        <view class="option-arrow">→</view>
      </view>

      <view class="option-card" bindtap="selectOption" data-value="no">
        <view class="option-icon">✗</view>
        <view class="option-content">
          <text class="option-title">不是</text>
          <text class="option-desc">不太符合我</text>
        </view>
        <view class="option-arrow">→</view>
      </view>
    </view>

    <!-- 导航按钮 -->
    <view class="nav-buttons" xhs:if="{{questions.length > 0}}">
      <button class="btn-ghost nav-btn {{currentIndex <= 0 ? 'disabled' : ''}}" 
              bindtap="prevQuestion" 
              hover-class="button-hover">
        上一题
      </button>
      <button xhs:if="{{!isAllAnswered}}" 
              class="btn-secondary nav-btn {{currentIndex >= questions.length - 1 ? 'disabled' : ''}}" 
              bindtap="nextQuestion"
              hover-class="button-hover">
        下一题
      </button>
      <button xhs:if="{{isAllAnswered}}" 
              class="btn-primary nav-btn" 
              bindtap="submitTest"
              hover-class="button-hover">
        提交测评
      </button>
    </view>

    <!-- 题目索引导航 -->
    <view class="question-nav">
      <scroll-view scroll-x 
                   class="question-nav-scroll"
                   scroll-into-view="{{scrollIntoView}}"
                   scroll-with-animation="{{true}}">
        <view class="question-nav-list">
          <view xhs:for-items="{{questions}}" 
                xhs:for-item="q" 
                xhs:for-index="idx"
                xhs:key="*item"
                id="nav-item-{{idx}}"
                class="question-nav-item {{answers[idx] ? 'answered' : ''}} {{currentIndex === idx ? 'current' : ''}}"
                bindtap="jumpToQuestion"
                data-index="{{idx}}">
            {{idx + 1}}
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- 退出提示弹窗 -->
    <view xhs:if="{{showExitModal}}" class="modal-mask" bindtap="hideExitModal">
      <view class="modal-content" catchtap="preventClose">
        <view class="modal-header">
          <text class="modal-title">确认退出？</text>
        </view>
        <view class="modal-body">
          <text class="modal-text">当前测评进度将会丢失，确定要退出吗？</text>
        </view>
        <view class="modal-footer">
          <button class="btn-ghost modal-btn" bindtap="hideExitModal">继续测评</button>
          <button class="btn-secondary modal-btn" bindtap="confirmExit">确认退出</button>
        </view>
      </view>
    </view>

    <!-- 底部安全区域 -->
    <view class="safe-area-bottom"></view>
  </view>
</view>
